function checkParameters(){var t=$("#personName").val(),e=$("#cellphone").val(),o=$("#totalPayment").html();if(!o||"0"===o)return alert("您还没有选择房间/套餐！"),!1;if(!t)return alert("请输入姓名！"),!1;if(!isCellphoneNumber(e))return alert("请输入正确的手机号码！"),!1;var r=parseInt($("#score").val()),n=parseInt($("#usableScore").html()),a=3*parseFloat(o);return r>n?(alert("您输入的积分超过当前可用的积分！"),!1):r>a?(alert("您输入的积分超过了房价的30%！"),!1):!0}function total(){totals=0,price=0,counts=0,$(".room").each(function(){"block"==$(this).children(".quantity").css("display")&&(counts=$(this).find(".room_quantity").html(),price=$(this).find(".price").html().replace("￥",""),totals+=parseFloat(counts)*parseFloat(price))}),$("#totalPayment").html(totals)}$(function(){$("#scoreConsume").click(function(){$(this).children("span").children("em").toggle(),$("#scoreDiv").toggle()}),$(".detail").click(function(){$(this).next().toggle(),$(this).children("span").children("em").toggle(),total()}),$(".reduce").click(function(){var t=parseInt($(this).parents(".room").find(".room_quantity").html());return 1>=t?($(this).parents(".room").find(".quantity").hide(),$(this).parents(".room").find("em").toggle(),total(),0):($(this).parents(".room").find(".room_quantity").html(--t),void total())}),$(".add").click(function(){var t=parseInt($(this).parents(".room").find(".room_quantity").html());$(this).parents(".room").find(".room_quantity").html(++t),total()}),$("#submitBtn").click(function(){if(checkParameters()){var t=[];$(".room").each(function(){if("block"==$(this).children(".quantity").css("display")){var e={};e.id=$(this).attr("db_id"),e.name=$(this).find(".room_name").html(),e.quantity=$(this).find(".room_quantity").html(),t.push(e)}}),console.log("Rooms INFO:"+JSON.stringify(t));var e=$("#csrf_token").val(),o=$("#personName").val(),r=$("#cellphone").val();if("none"!=$("#scoreDiv").css("display")&&$("#score").val())var n=parseInt($("#score").val());else var n=0;$.ajax({type:"post",url:"/wx/order/create",dataType:"json",data:{realname:o,cellphone:r,wxCasaId:$("#wxCasaId").val(),reservedRooms:t,score:n,_token:e},success:function(t){console.log("order create successfully!"),console.log(t),location.href="/wx/pay/wxorder/"+t.orderId},error:function(t){console.log(t.responseText),alert("订单创建失败！\nERROR INFO:\n"+t.responseText)}})}})});